<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Your Password | PetCare</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c7873;
            --secondary-color: #6fb98f;
            --accent-color: #ff9a3c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 1000px;
            min-height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .illustration-section {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: white;
            text-align: center;
        }

        .illustration {
            max-width: 100%;
            margin-bottom: 30px;
        }

        .illustration-section h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .illustration-section p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .form-section {
            flex: 1;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }

        .form-container {
            max-width: 400px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            color: var(--dark-color);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .country-code {
            position: absolute;
            left: 45px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 15px 15px 15px 75px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 120, 115, 0.1);
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #235e5a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .back-to-login {
            text-align: center;
            margin-top: 25px;
            color: #666;
        }

        .back-to-login a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .back-to-login a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        .message {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
        }

        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error-color);
            border-left: 4px solid var(--error-color);
        }

        .success-message {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .info-message {
            background: rgba(0, 123, 255, 0.1);
            color: #0069d9;
            border-left: 4px solid #0069d9;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e1e5e9;
            z-index: 1;
        }

        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e1e5e9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: #999;
            position: relative;
            z-index: 2;
        }

        .step.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step.completed {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-label {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            white-space: nowrap;
            color: #999;
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: 500;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .code-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .code-inputs input {
            flex: 1;
            text-align: center;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .resend-code {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .resend-code a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .resend-code a:hover {
            text-decoration: underline;
        }

        .password-strength {
            height: 5px;
            background: #e1e5e9;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .password-requirements {
            margin-top: 15px;
            font-size: 0.8rem;
            color: #666;
        }

        .requirement {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .requirement i {
            margin-right: 8px;
            font-size: 0.7rem;
        }

        .requirement.met {
            color: var(--success-color);
        }

        .success-checkmark {
            text-align: center;
            margin-bottom: 30px;
        }

        .success-checkmark i {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 20px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                max-width: 500px;
            }

            .illustration-section {
                padding: 30px 20px;
            }

            .illustration-section h2 {
                font-size: 1.5rem;
            }

            .form-section {
                padding: 40px 30px;
            }

            h1 {
                font-size: 1.7rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }

            .container {
                border-radius: 15px;
            }

            .form-section {
                padding: 30px 20px;
            }

            .illustration-section {
                padding: 25px 15px;
            }

            .logo {
                font-size: 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .code-inputs {
                gap: 8px;
            }

            .code-inputs input {
                padding: 12px;
                font-size: 1rem;
            }

            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="illustration-section">
            <svg class="illustration" width="300" height="250" viewBox="0 0 300 250" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M150 50C150 33.4315 136.569 20 120 20C103.431 20 90 33.4315 90 50C90 66.5685 103.431 80 120 80C136.569 80 150 66.5685 150 50Z" fill="white" fill-opacity="0.2"/>
                <path d="M180 150C180 133.431 166.569 120 150 120C133.431 120 120 133.431 120 150C120 166.569 133.431 180 150 180C166.569 180 180 166.569 180 150Z" fill="white" fill-opacity="0.2"/>
                <path d="M60 150C60 133.431 46.5685 120 30 120C13.4315 120 0 133.431 0 150C0 166.569 13.4315 180 30 180C46.5685 180 60 166.569 60 150Z" fill="white" fill-opacity="0.2"/>
                <path d="M240 100C240 83.4315 226.569 70 210 70C193.431 70 180 83.4315 180 100C180 116.569 193.431 130 210 130C226.569 130 240 116.569 240 100Z" fill="white" fill-opacity="0.2"/>
                <circle cx="150" cy="125" r="80" fill="white" fill-opacity="0.3"/>
                <path d="M130 110C130 97.2975 140.298 87 153 87H167C171.418 87 175 90.5817 175 95C175 99.4183 171.418 103 167 103H153C148.582 103 145 106.582 145 111C145 115.418 148.582 119 153 119H167C171.418 119 175 122.582 175 127C175 131.418 171.418 135 167 135H153C140.298 135 130 124.703 130 112V110Z" fill="white"/>
                <path d="M160 95C162.209 95 164 93.2091 164 91C164 88.7909 162.209 87 160 87C157.791 87 156 88.7909 156 91C156 93.2091 157.791 95 160 95Z" fill="white"/>
                <path d="M160 143C162.209 143 164 141.209 164 139C164 136.791 162.209 135 160 135C157.791 135 156 136.791 156 139C156 141.209 157.791 143 160 143Z" fill="white"/>
                <path d="M190 110H200C202.209 110 204 111.791 204 114C204 116.209 202.209 118 200 118H190C187.791 118 186 116.209 186 114C186 111.791 187.791 110 190 110Z" fill="white"/>
            </svg>
            <h2>Reset Your Password</h2>
            <p>Enter your mobile number and we'll send you an OTP to reset your password.</p>
        </div>

        <div class="form-section">
            <div class="logo">
                <i class="fas fa-paw"></i>
                <span>PetCare</span>
            </div>

            <div class="form-container">
                <div class="steps">
                    <div class="step active" id="step1">
                        1
                        <span class="step-label">Mobile</span>
                    </div>
                    <div class="step" id="step2">
                        2
                        <span class="step-label">OTP</span>
                    </div>
                    <div class="step" id="step3">
                        3
                        <span class="step-label">New Password</span>
                    </div>
                    <div class="step" id="step4">
                        4
                        <span class="step-label">Done</span>
                    </div>
                </div>

                <!-- Step 1: Mobile Number Input -->
                <div class="step-content active" id="stepContent1">
                    <h1>Forgot Password?</h1>
                    <p class="subtitle">Enter your mobile number and we'll send you an OTP to reset your password.</p>

                    <div class="message error-message" id="mobileError">
                        Please enter a valid 10-digit mobile number.
                    </div>

                    <form id="mobileForm">
                        <div class="form-group">
                            <label for="mobile">Mobile Number</label>
                            <div class="input-with-icon">
                                <i class="fas fa-mobile-alt"></i>
                                <span class="country-code">+91</span>
                                <input type="tel" id="mobile" placeholder="98765 43210" maxlength="10" required>
                            </div>
                        </div>

                        <button type="submit" class="btn">Send OTP</button>
                    </form>

                    <div class="back-to-login">
                        Remember your password? <a href="login.html">Back to Login</a>
                    </div>
                </div>

                <!-- Step 2: OTP Verification -->
                <div class="step-content" id="stepContent2">
                    <h1>Enter OTP</h1>
                    <p class="subtitle">We've sent a 6-digit OTP to <span id="userMobile" style="font-weight: 500;">+91 98765 43210</span></p>

                    <div class="message error-message" id="otpError">
                        Please enter the correct 6-digit OTP.
                    </div>

                    <div class="message info-message" id="otpSuccess">
                        OTP has been sent successfully!
                    </div>

                    <form id="otpForm">
                        <div class="form-group">
                            <label for="otp">OTP Code</label>
                            <div class="code-inputs">
                                <input type="text" maxlength="1" class="otp-input" required>
                                <input type="text" maxlength="1" class="otp-input" required>
                                <input type="text" maxlength="1" class="otp-input" required>
                                <input type="text" maxlength="1" class="otp-input" required>
                                <input type="text" maxlength="1" class="otp-input" required>
                                <input type="text" maxlength="1" class="otp-input" required>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" id="backToMobile">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button type="submit" class="btn">Verify OTP</button>
                        </div>
                    </form>

                    <div class="resend-code">
                        Didn't receive the OTP? <a href="#" id="resendOtp">Resend OTP</a>
                        <span id="countdown"> (60s)</span>
                    </div>
                </div>

                <!-- Step 3: New Password -->
                <div class="step-content" id="stepContent3">
                    <h1>Create New Password</h1>
                    <p class="subtitle">Your new password must be different from previous used passwords.</p>

                    <div class="message error-message" id="passwordError">
                        Please make sure your passwords match and meet the requirements.
                    </div>

                    <form id="passwordForm">
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="newPassword" placeholder="Enter new password" required>
                            </div>
                            <div class="password-strength">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                            <div class="password-requirements">
                                <div class="requirement" id="reqLength">
                                    <i class="fas fa-circle"></i>
                                    At least 8 characters
                                </div>
                                <div class="requirement" id="reqUpper">
                                    <i class="fas fa-circle"></i>
                                    One uppercase letter
                                </div>
                                <div class="requirement" id="reqLower">
                                    <i class="fas fa-circle"></i>
                                    One lowercase letter
                                </div>
                                <div class="requirement" id="reqNumber">
                                    <i class="fas fa-circle"></i>
                                    One number
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" id="backToOtp">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button type="submit" class="btn">Reset Password</button>
                        </div>
                    </form>
                </div>

                <!-- Step 4: Success -->
                <div class="step-content" id="stepContent4">
                    <div class="success-checkmark">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h1>Password Reset Successfully!</h1>
                    <p class="subtitle">Your password has been reset successfully. You can now login with your new password.</p>

                    <button class="btn" id="backToLogin">Back to Login</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // DOM Elements
    const steps = document.querySelectorAll('.step');
    const stepContents = document.querySelectorAll('.step-content');
    const mobileForm = document.getElementById('mobileForm');
    const otpForm = document.getElementById('otpForm');
    const passwordForm = document.getElementById('passwordForm');
    const otpInputs = document.querySelectorAll('.otp-input');
    const mobileError = document.getElementById('mobileError');
    const otpError = document.getElementById('otpError');
    const otpSuccess = document.getElementById('otpSuccess');
    const passwordError = document.getElementById('passwordError');
    const userMobile = document.getElementById('userMobile');
    const resendOtp = document.getElementById('resendOtp');
    const backToLogin = document.getElementById('backToLogin');
    const backToMobile = document.getElementById('backToMobile');
    const backToOtp = document.getElementById('backToOtp');
    const passwordStrengthBar = document.getElementById('passwordStrengthBar');
    const countdownElement = document.getElementById('countdown');
    const passwordRequirements = {
        length: document.getElementById('reqLength'),
        upper: document.getElementById('reqUpper'),
        lower: document.getElementById('reqLower'),
        number: document.getElementById('reqNumber')
    };

    // Current step and data
    let currentStep = 1;
    let countdown;
    let countdownTime = 60;
    let userMobileNumber = '';

    // API Base URL - Update this to your backend URL
    const API_BASE_URL = 'http://localhost:3000/reset-password';

 // Change to your backend URL

    // Mobile validation
    function isValidMobile(mobile) {
        const mobileRegex = /^[6-9]\d{9}$/;
        return mobileRegex.test(mobile);
    }

    // Format mobile number for display
    function formatMobileNumber(mobile) {
        return `+91 ${mobile.substring(0, 5)} ${mobile.substring(5)}`;
    }

    // Password strength calculation
    function calculatePasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 25;
        
        // Upper and lower case check
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
        
        // Number check
        if (/\d/.test(password)) strength += 25;
        
        // Special character check
        if (/[^A-Za-z0-9]/.test(password)) strength += 25;
        
        return strength;
    }

    // Update password requirements
    function updatePasswordRequirements(password) {
        // Length requirement
        if (password.length >= 8) {
            passwordRequirements.length.classList.add('met');
            passwordRequirements.length.innerHTML = '<i class="fas fa-check"></i> At least 8 characters';
        } else {
            passwordRequirements.length.classList.remove('met');
            passwordRequirements.length.innerHTML = '<i class="fas fa-circle"></i> At least 8 characters';
        }
        
        // Uppercase requirement
        if (/[A-Z]/.test(password)) {
            passwordRequirements.upper.classList.add('met');
            passwordRequirements.upper.innerHTML = '<i class="fas fa-check"></i> One uppercase letter';
        } else {
            passwordRequirements.upper.classList.remove('met');
            passwordRequirements.upper.innerHTML = '<i class="fas fa-circle"></i> One uppercase letter';
        }
        
        // Lowercase requirement
        if (/[a-z]/.test(password)) {
            passwordRequirements.lower.classList.add('met');
            passwordRequirements.lower.innerHTML = '<i class="fas fa-check"></i> One lowercase letter';
        } else {
            passwordRequirements.lower.classList.remove('met');
            passwordRequirements.lower.innerHTML = '<i class="fas fa-circle"></i> One lowercase letter';
        }
        
        // Number requirement
        if (/\d/.test(password)) {
            passwordRequirements.number.classList.add('met');
            passwordRequirements.number.innerHTML = '<i class="fas fa-check"></i> One number';
        } else {
            passwordRequirements.number.classList.remove('met');
            passwordRequirements.number.innerHTML = '<i class="fas fa-circle"></i> One number';
        }
    }

    // Start OTP countdown
    function startCountdown() {
        countdownTime = 60;
        countdownElement.textContent = ` (${countdownTime}s)`;
        resendOtp.style.pointerEvents = 'none';
        resendOtp.style.opacity = '0.5';
        
        countdown = setInterval(() => {
            countdownTime--;
            countdownElement.textContent = ` (${countdownTime}s)`;
            
            if (countdownTime <= 0) {
                clearInterval(countdown);
                countdownElement.textContent = '';
                resendOtp.style.pointerEvents = 'auto';
                resendOtp.style.opacity = '1';
            }
        }, 1000);
    }

    // Move to next step
    function goToStep(step) {
        // Hide all step contents
        stepContents.forEach(content => {
            content.classList.remove('active');
        });
        
        // Remove active class from all steps
        steps.forEach(stepEl => {
            stepEl.classList.remove('active');
        });
        
        // Show current step content
        document.getElementById(`stepContent${step}`).classList.add('active');
        
        // Mark all previous steps as completed
        for (let i = 1; i < step; i++) {
            document.getElementById(`step${i}`).classList.add('completed');
        }
        
        // Mark current step as active
        document.getElementById(`step${step}`).classList.add('active');
        
        currentStep = step;
    }

    // Show message
    function showMessage(element, message) {
        if (message) element.textContent = message;
        element.style.display = 'block';
        setTimeout(() => {
            element.style.display = 'none';
        }, 5000);
    }

    // API Calls
    async function sendResetOTP(mobileNumber) {
        try {
            const response = await fetch(`${API_BASE_URL}/send-reset-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mobile_number: mobileNumber })
            });

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error sending OTP:', error);
            return { success: false, message: 'Network error. Please try again.' };
        }
    }

    async function verifyResetOTP(mobileNumber, otp) {
        try {
            const response = await fetch(`${API_BASE_URL}/verify-reset-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    mobile_number: mobileNumber, 
                    otp: otp 
                })
            });

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error verifying OTP:', error);
            return { success: false, message: 'Network error. Please try again.' };
        }
    }

    async function resetPassword(mobileNumber, newPassword) {
        try {
            const response = await fetch(`${API_BASE_URL}/reset-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    mobile_number: mobileNumber, 
                    new_password: newPassword 
                })
            });

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error resetting password:', error);
            return { success: false, message: 'Network error. Please try again.' };
        }
    }

    async function resendResetOTP(mobileNumber) {
        try {
            const response = await fetch(`${API_BASE_URL}/resend-reset-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mobile_number: mobileNumber })
            });

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error resending OTP:', error);
            return { success: false, message: 'Network error. Please try again.' };
        }
    }

    // Event Listeners

    // Mobile form submission
    mobileForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const mobile = document.getElementById('mobile').value;
        
        if (isValidMobile(mobile)) {
            mobileError.style.display = 'none';
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Sending OTP...';
            submitBtn.disabled = true;
            
            // Send OTP via API
            const result = await sendResetOTP(mobile);
            
            if (result.success) {
                userMobileNumber = mobile;
                userMobile.textContent = formatMobileNumber(mobile);
                
                // Show success message and start countdown
                otpSuccess.style.display = 'block';
                startCountdown();
                
                setTimeout(() => {
                    goToStep(2);
                }, 1000);
            } else {
                showMessage(mobileError, result.message);
            }
            
            // Reset button state
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            
        } else {
            showMessage(mobileError, 'Please enter a valid 10-digit mobile number');
        }
    });

    // OTP input navigation
    otpInputs.forEach((input, index) => {
        input.addEventListener('input', function() {
            if (this.value.length === 1 && index < otpInputs.length - 1) {
                otpInputs[index + 1].focus();
            }
        });
        
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                otpInputs[index - 1].focus();
            }
        });
    });

    // OTP form submission
    otpForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        let otp = '';
        otpInputs.forEach(input => {
            otp += input.value;
        });
        
        if (otp.length === 6) {
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Verifying...';
            submitBtn.disabled = true;
            
            // Verify OTP via API
            const result = await verifyResetOTP(userMobileNumber, otp);
            
            if (result.success) {
                otpError.style.display = 'none';
                goToStep(3);
            } else {
                showMessage(otpError, result.message);
            }
            
            // Reset button state
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        } else {
            showMessage(otpError, 'Please enter the complete 6-digit OTP');
        }
    });

    // Password strength indicator
    document.getElementById('newPassword').addEventListener('input', function() {
        const strength = calculatePasswordStrength(this.value);
        passwordStrengthBar.style.width = `${strength}%`;
        
        // Change color based on strength
        if (strength < 50) {
            passwordStrengthBar.style.background = '#dc3545';
        } else if (strength < 75) {
            passwordStrengthBar.style.background = '#ffc107';
        } else {
            passwordStrengthBar.style.background = '#28a745';
        }
        
        // Update requirements
        updatePasswordRequirements(this.value);
    });

    // Password form submission
    passwordForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Check if passwords match and meet requirements
        if (newPassword === confirmPassword && calculatePasswordStrength(newPassword) >= 75) {
            passwordError.style.display = 'none';
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Resetting Password...';
            submitBtn.disabled = true;
            
            // Reset password via API
            const result = await resetPassword(userMobileNumber, newPassword);
            
            if (result.success) {
                goToStep(4);
            } else {
                showMessage(passwordError, result.message);
            }
            
            // Reset button state
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            
        } else {
            showMessage(passwordError, 'Please make sure your passwords match and meet the requirements');
        }
    });

    // Resend OTP
    resendOtp.addEventListener('click', async function(e) {
        e.preventDefault();
        
        if (countdownTime > 0) return;
        
        // Show loading state
        const originalText = resendOtp.textContent;
        resendOtp.textContent = 'Sending...';
        resendOtp.style.pointerEvents = 'none';
        
        // Resend OTP via API
        const result = await resendResetOTP(userMobileNumber);
        
        if (result.success) {
            startCountdown();
            otpSuccess.style.display = 'block';
            setTimeout(() => {
                otpSuccess.style.display = 'none';
            }, 3000);
        } else {
            showMessage(otpError, result.message);
        }
        
        // Reset button state
        resendOtp.textContent = originalText;
    });

    // Back to mobile step
    backToMobile.addEventListener('click', function() {
        goToStep(1);
    });

    // Back to OTP step
    backToOtp.addEventListener('click', function() {
        goToStep(2);
    });

    // Back to login
    backToLogin.addEventListener('click', function() {
        window.location.href = 'login.html';
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Focus on mobile input when page loads
        document.getElementById('mobile').focus();
    });
</script>
</body>
</html>