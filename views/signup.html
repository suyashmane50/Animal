<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sindhudurg Pet Care - Signup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/login.css">
  <style>
    :root {
      --primary-color: #2c7873;
      --secondary-color: #6ab187;
      --accent-color: #f0a500;
    }
    .otp-container { display: none; }
    .otp-input-group { display: flex; gap: 10px; justify-content: center; margin: 15px 0; }
    .otp-input {
      width: 50px; height: 50px; text-align: center; font-size: 1.2rem;
      border: 2px solid #e0e0e0; border-radius: 8px;
    }
    .otp-input:focus { border-color: var(--primary-color); box-shadow: 0 0 5px rgba(44, 120, 115, 0.3); }
    .timer { text-align: center; color: #666; font-size: 0.9rem; margin: 10px 0; }
    .resend-otp { text-align: center; margin: 15px 0; }
    .resend-otp a { color: var(--primary-color); text-decoration: none; }
    .resend-otp a:hover { text-decoration: underline; }
    .verification-success {
      background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724;
      padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0; display: none;
    }
    .btn-verify { background: var(--secondary-color); color: white; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 600; }
    .btn-verify:hover { background: #5da57a; }
    .mobile-verification-status { display: flex; align-items: center; gap: 8px; margin-top: 5px; font-size: 0.9rem; }
    .status-verified { color: var(--secondary-color); }
    .status-pending { color: var(--accent-color); }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-card fade-in" id="signupForm">
      <div class="row g-0">
        <!-- Left -->
        <div class="col-lg-6 login-left">
          <div class="logo"><i class="fas fa-paw"></i>Sindhudurg Pet Care</div>
          <h1 class="welcome-title">Create Account</h1>
          <p>Join the Sindhudurg Pet Care Management System to help ensure the wellbeing of animals across our district.</p>
          <ul>
            <li><i class="fas fa-check-circle"></i> Easy pet registration</li>
            <li><i class="fas fa-check-circle"></i> Veterinary services</li>
            <li><i class="fas fa-check-circle"></i> Health monitoring</li>
            <li><i class="fas fa-check-circle"></i> Checkup reminders</li>
          </ul>
          <a href="/login" class="btn btn-signup">Already have an account? Sign In</a>
        </div>

        <!-- Right -->
        <div class="col-lg-6 login-right">
          <h2 class="login-title">Sign Up</h2>
          <form id="signupFormElement">
            <div class="form-group">
              <label>Full Name</label>
              <input placeholder="Enter Your Full Name" type="text" id="signupUsername" class="form-control" required>
            </div>

            <div class="form-group">
              <label>Mobile Number</label>
              <div class="input-group">
                <span class="input-group-text">+91</span>
                <input placeholder="Enter Your Mobile Number" type="tel" id="mobileNumber" class="form-control" maxlength="10" required>
                <button type="button" class="btn btn-verify" id="sendOtpBtn">Send OTP</button>
              </div>
              <p id="otpDisplay" style="display:none; margin-top:10px; color:green; font-weight:bold;"></p>

              <div id="mobileStatus" class="mobile-verification-status">
                <i class="fas fa-circle status-pending"></i>
                <span>Mobile number not verified</span>
              </div>
            </div>

            <!-- OTP Section -->
            <div class="otp-container" id="otpContainer">
              <div class="otp-input-group">
                <input type="text" maxlength="1" class="otp-input" data-index="1">
                <input type="text" maxlength="1" class="otp-input" data-index="2">
                <input type="text" maxlength="1" class="otp-input" data-index="3">
                <input type="text" maxlength="1" class="otp-input" data-index="4">
                <input type="text" maxlength="1" class="otp-input" data-index="5">
                <input type="text" maxlength="1" class="otp-input" data-index="6">
              </div>
              <div class="timer" id="timer">02:00</div>
              <div class="resend-otp"><a href="#" id="resendOtp">Resend OTP</a></div>
              <button type="button" class="btn btn-login w-100" id="verifyOtpBtn">Verify OTP</button>
              <div class="verification-success" id="verificationSuccess">
                <i class="fas fa-check-circle"></i> Mobile verified successfully!
              </div>
            </div>

            <div class="form-group">
              <label>Password</label>
              <input type="password" id="signupPassword" class="form-control" required>
            </div>
            <div class="form-group">
              <label>Confirm Password</label>
              <input type="password" id="confirmPassword" class="form-control" required>
            </div>

            <div class="form-group">
              <label>District</label>
              <select id="district" class="form-control" required>
                <option value="">Select District</option>
              </select>
            </div>
            <div class="form-group">
              <label>Taluka</label>
              <select id="taluka" class="form-control" required>
                <option value="">Select Taluka</option>
              </select>
            </div>
            <div class="form-group">
              <label>Village</label>
              <select id="village" class="form-control" required>
                <option value="">Select Village</option>
              </select>
            </div>

            <div class="form-group form-check">
              <input type="checkbox" class="form-check-input" id="agreeTerms" required>
              <label class="form-check-label">I agree to the <a href="#">Terms</a> & <a href="#">Privacy Policy</a></label>
            </div>

            <button type="submit" class="btn btn-login w-100">Create Account</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("DOM loaded - initializing signup form");

  const sendOtpBtn = document.getElementById("sendOtpBtn");
  const verifyOtpBtn = document.getElementById("verifyOtpBtn");
  const otpContainer = document.getElementById("otpContainer");
  const mobileInput = document.getElementById("mobileNumber");
  const mobileStatus = document.getElementById("mobileStatus");
  const verificationSuccess = document.getElementById("verificationSuccess");
  const resendOtpBtn = document.getElementById("resendOtp");
  const timerDisplay = document.getElementById("timer");
  const otpDisplay = document.getElementById("otpDisplay");
  const otpInputs = document.querySelectorAll(".otp-input");

  // ðŸ•“ Timer variables
  let timerInterval;

  // ðŸ”¹ Send OTP
  async function sendOtpToServer() {
    const mobileNumber = mobileInput.value.trim();

    if (!/^[6-9]\d{9}$/.test(mobileNumber)) {
      alert("Please enter a valid 10-digit mobile number");
      return;
    }

    try {
      sendOtpBtn.disabled = true;
      sendOtpBtn.textContent = "Sending...";
      const response = await fetch("/signup/send-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobileNumber }),
      });

      const data = await response.json();
      if (data.success) {
        otpContainer.style.display = "block";
        alert("OTP sent successfully!");
        startTimer();

        // ðŸ§ª Show OTP (for demo/testing)
        if (data.otp) {
          otpDisplay.innerHTML = `<strong>Test OTP:</strong> <span style="color:green; font-size:1.2em;">${data.otp}</span>`;
          otpDisplay.style.display = "block";
        }
      } else {
        alert(data.message || "Failed to send OTP");
      }
    } catch (err) {
      console.error("Error sending OTP:", err);
      alert("Something went wrong while sending OTP");
    } finally {
      sendOtpBtn.disabled = false;
      sendOtpBtn.textContent = "Send OTP";
    }
  }

  // ðŸ”¹ Verify OTP
  async function verifyOtpWithServer() {
    const otp = Array.from(otpInputs).map((input) => input.value).join("");
    const mobileNumber = mobileInput.value.trim();

    if (otp.length !== 6) {
      alert("Please enter the complete 6-digit OTP");
      return;
    }

    try {
      verifyOtpBtn.disabled = true;
      verifyOtpBtn.textContent = "Verifying...";

      const response = await fetch("/signup/verify-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobileNumber, otp }),
      });

      const data = await response.json();
      if (data.success) {
        otpContainer.style.display = "none";
        verificationSuccess.style.display = "block";
        mobileStatus.innerHTML = `<i class="fas fa-check-circle text-success"></i> <span>Mobile number verified</span>`;
        alert("Mobile number verified successfully!");
        otpDisplay.style.display = "none";
      } else {
        alert(data.message || "Invalid OTP");
      }
    } catch (err) {
      console.error("Error verifying OTP:", err);
      alert("Something went wrong while verifying OTP");
    } finally {
      verifyOtpBtn.disabled = false;
      verifyOtpBtn.textContent = "Verify OTP";
    }
  }

  // ðŸ”¹ Start timer (2 minutes)
  function startTimer() {
    let timeLeft = 120;
    resendOtpBtn.classList.add("disabled");
    resendOtpBtn.style.pointerEvents = "none";

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
      const seconds = String(timeLeft % 60).padStart(2, "0");
      timerDisplay.textContent = `${minutes}:${seconds}`;

      if (timeLeft-- <= 0) {
        clearInterval(timerInterval);
        timerDisplay.textContent = "00:00";
        resendOtpBtn.classList.remove("disabled");
        resendOtpBtn.style.pointerEvents = "auto";
      }
    }, 1000);
  }

  // ðŸ”¹ Resend OTP
  async function resendOtp() {
    const mobileNumber = mobileInput.value.trim();
    if (!mobileNumber) {
      alert("Enter mobile number first");
      return;
    }

    try {
      resendOtpBtn.disabled = true;
      const response = await fetch("/signup/resend-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobileNumber }),
      });

      const data = await response.json();
      if (data.success) {
        alert("New OTP sent successfully!");
        startTimer();

        if (data.otp) {
          otpDisplay.innerHTML = `<strong>New OTP:</strong> <span style="color:green; font-size:1.2em;">${data.otp}</span>`;
          otpDisplay.style.display = "block";
        }
      } else {
        alert(data.message || "Failed to resend OTP");
      }
    } catch (err) {
      console.error("Error resending OTP:", err);
      alert("Something went wrong while resending OTP");
    } finally {
      resendOtpBtn.disabled = false;
    }
  }

  // ðŸ”¹ OTP Input Handling + Paste Option
  otpInputs.forEach((input, index) => {
    input.addEventListener("input", (e) => {
      const value = e.target.value.replace(/\D/g, "");
      e.target.value = value;
      if (value && index < otpInputs.length - 1) {
        otpInputs[index + 1].focus();
      }
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && !input.value && index > 0) {
        otpInputs[index - 1].focus();
      }
    });

    // ðŸ‘‡ Handle OTP paste (paste all 6 digits)
    input.addEventListener("paste", (e) => {
      e.preventDefault();
      const pasteData = e.clipboardData.getData("text").trim();
      if (/^\d{6}$/.test(pasteData)) {
        otpInputs.forEach((inp, i) => {
          inp.value = pasteData[i] || "";
        });
        otpInputs[otpInputs.length - 1].focus();
      }
    });
  });

  // ðŸ”¹ Event Listeners
  sendOtpBtn.addEventListener("click", sendOtpToServer);
  verifyOtpBtn.addEventListener("click", verifyOtpWithServer);
  resendOtpBtn.addEventListener("click", resendOtp);
});
</script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const districtSelect = document.getElementById("district");
  const talukaSelect = document.getElementById("taluka");
  const villageSelect = document.getElementById("village");

  // ðŸ™ Load districts
  try {
    const res = await fetch("/signup/districts");
    const data = await res.json();
    if (data.success) {
      data.districts.forEach((d) => {
        const opt = document.createElement("option");
        opt.value = d.id;
        opt.textContent = d.name;
        districtSelect.appendChild(opt);
      });
    }
  } catch (err) {
    console.error("Failed to load districts:", err);
  }

  // ðŸ˜ Load talukas when district changes
  districtSelect.addEventListener("change", async () => {
    talukaSelect.innerHTML = '<option value="">Select Taluka</option>';
    villageSelect.innerHTML = '<option value="">Select Village</option>';

    if (!districtSelect.value) return;

    try {
      const res = await fetch(`/signup/talukas/${districtSelect.value}`);
      const data = await res.json();
      if (data.success) {
        data.talukas.forEach((t) => {
          const opt = document.createElement("option");
          opt.value = t.id;
          opt.textContent = t.name;
          talukaSelect.appendChild(opt);
        });
      }
    } catch (err) {
      console.error("Failed to load talukas:", err);
    }
  });

  // ðŸ¡ Load villages when taluka changes
  talukaSelect.addEventListener("change", async () => {
    villageSelect.innerHTML = '<option value="">Select Village</option>';

    if (!talukaSelect.value) return;

    try {
      const res = await fetch(`/signup/villages/${talukaSelect.value}`);
      const data = await res.json();
      if (data.success) {
        data.villages.forEach((v) => {
          const opt = document.createElement("option");
          opt.value = v.id;
          opt.textContent = v.name;
          villageSelect.appendChild(opt);
        });
      }
    } catch (err) {
      console.error("Failed to load villages:", err);
    }
  });
});
</script>



</body>
</html>
