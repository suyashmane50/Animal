<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaccination Report - Sindhudurg Pet Care</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .report-title {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .report-date {
            color: #7f8c8d;
            font-size: 14px;
        }
        .vaccination-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .table-header {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-download {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-download:hover {
            background: #219a52;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: #ecf0f1;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #bdc3c7;
        }
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .status-completed {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Report Header -->
        <div class="report-header">
            <h1 class="report-title">Vaccination Report</h1>
            <p class="report-date">Generated on: <span id="currentDate"></span></p>
            <p class="report-subtitle">Sindhudurg Pet Care - Complete Vaccination History</p>
        </div>

        <!-- Vaccination Data Table -->
        <div class="vaccination-table">
            <div class="table-header">
                <h3 style="margin: 0; font-size: 18px;">Vaccination Records</h3>
                <button class="btn-download" onclick="downloadPDF()">
                    <i class="fas fa-download me-2"></i>Download PDF
                </button>
            </div>
            
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Pet Name</th>
                            <th>Vaccine Type</th>
                            <th>Date Given</th>
                            <th>Next Due Date</th>
                            <th>Veterinarian</th>
                            <th>Status</th>
                            <th>Batch No.</th>
                        </tr>
                    </thead>
                    <tbody id="vaccinationData">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Summary Section -->
        <div style="margin-top: 20px; text-align: center; color: #7f8c8d; font-size: 14px;">
            <p>Total Vaccinations: <span id="totalCount">0</span> | 
               Completed: <span id="completedCount">0</span> | 
               Pending: <span id="pendingCount">0</span></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Sample vaccination data
        const vaccinationData = [
            {
                petName: "Max",
                vaccineType: "Rabies Vaccine",
                dateGiven: "2024-01-15",
                nextDue: "2025-01-15",
                veterinarian: "Dr. Rajesh Patil",
                status: "completed",
                batchNo: "RB-2024-001"
            },
            {
                petName: "Mittens",
                vaccineType: "FVRCP Vaccine",
                dateGiven: "2024-02-20",
                nextDue: "2025-02-20",
                veterinarian: "Dr. Priya Sharma",
                status: "completed",
                batchNo: "FV-2024-045"
            },
            {
                petName: "Buddy",
                vaccineType: "DHPP Vaccine",
                dateGiven: "2024-03-10",
                nextDue: "2024-09-10",
                veterinarian: "Dr. Rajesh Patil",
                status: "completed",
                batchNo: "DH-2024-078"
            },
            {
                petName: "Max",
                vaccineType: "Bordetella Vaccine",
                dateGiven: "",
                nextDue: "2024-12-01",
                veterinarian: "Dr. Amit Kumar",
                status: "pending",
                batchNo: "BR-2024-123"
            },
            {
                petName: "Mittens",
                vaccineType: "Rabies Booster",
                dateGiven: "",
                nextDue: "2024-11-15",
                veterinarian: "Dr. Priya Sharma",
                status: "pending",
                batchNo: "RB-2024-156"
            },
            {
                petName: "Buddy",
                vaccineType: "Leptospirosis Vaccine",
                dateGiven: "2024-04-05",
                nextDue: "2024-10-05",
                veterinarian: "Dr. Rajesh Patil",
                status: "completed",
                batchNo: "LP-2024-089"
            },
            {
                petName: "Max",
                vaccineType: "Canine Influenza",
                dateGiven: "2024-05-20",
                nextDue: "2025-05-20",
                veterinarian: "Dr. Amit Kumar",
                status: "completed",
                batchNo: "CI-2024-067"
            }
        ];

        // Initialize the report
        document.addEventListener('DOMContentLoaded', function() {
            displayCurrentDate();
            loadVaccinationData();
            updateSummary();
        });

        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function loadVaccinationData() {
            const tbody = document.getElementById('vaccinationData');
            tbody.innerHTML = '';

            if (vaccinationData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class="fas fa-info-circle" style="font-size: 48px; margin-bottom: 10px;"></i>
                            <p>No vaccination records found.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            vaccinationData.forEach(vaccine => {
                const row = document.createElement('tr');
                
                const statusClass = vaccine.status === 'completed' ? 'status-completed' : 'status-pending';
                const dateGiven = vaccine.dateGiven ? formatDate(vaccine.dateGiven) : 'Not Given';
                const nextDue = formatDate(vaccine.nextDue);

                row.innerHTML = `
                    <td>${vaccine.petName}</td>
                    <td>${vaccine.vaccineType}</td>
                    <td>${dateGiven}</td>
                    <td>${nextDue}</td>
                    <td>${vaccine.veterinarian}</td>
                    <td><span class="${statusClass}">${vaccine.status.toUpperCase()}</span></td>
                    <td>${vaccine.batchNo}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function updateSummary() {
            const total = vaccinationData.length;
            const completed = vaccinationData.filter(v => v.status === 'completed').length;
            const pending = vaccinationData.filter(v => v.status === 'pending').length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('pendingCount').textContent = pending;
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(18);
            doc.setTextColor(44, 62, 80);
            doc.text('Vaccination Report - Sindhudurg Pet Care', 20, 20);
            
            // Date
            doc.setFontSize(10);
            doc.setTextColor(127, 140, 141);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 30);
            
            // Table headers
            doc.setFontSize(11);
            doc.setTextColor(255, 255, 255);
            doc.setFillColor(52, 152, 219);
            doc.rect(20, 40, 170, 10, 'F');
            doc.text('Pet Name', 22, 46);
            doc.text('Vaccine Type', 50, 46);
            doc.text('Date Given', 90, 46);
            doc.text('Next Due', 120, 46);
            doc.text('Veterinarian', 145, 46);
            doc.text('Status', 175, 46);
            
            // Table data
            let yPosition = 55;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(9);
            
            vaccinationData.forEach((vaccine, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const dateGiven = vaccine.dateGiven ? formatDate(vaccine.dateGiven) : 'Not Given';
                const nextDue = formatDate(vaccine.nextDue);
                
                doc.text(vaccine.petName, 22, yPosition);
                doc.text(vaccine.vaccineType, 50, yPosition);
                doc.text(dateGiven, 90, yPosition);
                doc.text(nextDue, 120, yPosition);
                doc.text(vaccine.veterinarian, 145, yPosition);
                doc.text(vaccine.status.toUpperCase(), 175, yPosition);
                
                yPosition += 8;
                
                // Add separator line
                if (index < vaccinationData.length - 1) {
                    doc.setDrawColor(236, 240, 241);
                    doc.line(20, yPosition - 2, 190, yPosition - 2);
                }
            });
            
            // Summary
            yPosition += 10;
            doc.setFontSize(10);
            doc.setTextColor(127, 140, 141);
            const completed = vaccinationData.filter(v => v.status === 'completed').length;
            const pending = vaccinationData.filter(v => v.status === 'pending').length;
            doc.text(`Total Vaccinations: ${vaccinationData.length} | Completed: ${completed} | Pending: ${pending}`, 20, yPosition);
            
            // Save PDF
            doc.save(`vaccination-report-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // You can also add functionality to fetch real data from your backend
        async function fetchVaccinationData() {
            try {
                const response = await fetch('/api/vaccinations');
                const result = await response.json();
                
                if (result.success) {
                    // Replace sample data with real data
                    // vaccinationData = result.data;
                    loadVaccinationData();
                    updateSummary();
                }
            } catch (error) {
                console.error('Error fetching vaccination data:', error);
            }
        }

        // Uncomment the line below to fetch real data when the page loads
        // fetchVaccinationData();
    </script>
</body>
</html>